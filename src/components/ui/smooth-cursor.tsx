
'use client';

import { useEffect, useRef } from "react";
import { cn } from "@/lib/utils";

export function SmoothCursor() {
  const cursorRef = useRef<HTMLDivElement>(null);
  const clickEffectRef = useRef<HTMLDivElement>(null);
  const isgrabbing = useRef(false);

  useEffect(() => {
    const cursor = cursorRef.current;
    if (!cursor) {
      return;
    }

    let mouseX = -100;
    let mouseY = -100;
    let cursorX = -100;
    let cursorY = -100;
    let speed = 0.1;

    const mouseMove = (e: MouseEvent) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
    };

    const mouseDown = () => {
      isgrabbing.current = true;
      if (cursor) {
        cursor.classList.add('opacity-0');
      }
      if(clickEffectRef.current) {
        clickEffectRef.current.classList.remove('hidden');
        // Restart animation
        if (clickEffectRef.current.firstElementChild) {
          clickEffectRef.current.firstElementChild.remove();
        }
        const newEffect = document.createElement('div');
        newEffect.className = "h-32 w-32 rounded-full border-2";
        newEffect.style.borderColor = 'hsl(var(--cursor-color))';
        newEffect.style.animation = 'click-pulse 0.5s ease-out forwards';
        clickEffectRef.current.appendChild(newEffect);
      }
    };

    const mouseUp = () => {
      isgrabbing.current = false;
      if (cursor) {
        cursor.classList.remove('opacity-0');
      }
      if(clickEffectRef.current) {
        const child = clickEffectRef.current.firstElementChild;
        if (child) {
            child.addEventListener('animationend', () => {
                if (clickEffectRef.current) {
                     clickEffectRef.current.classList.add('hidden');
                }
            });
        }
      }
    };

    const animate = () => {
      let distX = mouseX - cursorX;
      let distY = mouseY - cursorY;

      cursorX = cursorX + distX * speed;
      cursorY = cursorY + distY * speed;
      
      const angle = Math.atan2(distY, distX) * (180 / Math.PI) + 90;

      if (cursor) {
          cursor.style.left = cursorX + "px";
          cursor.style.top = cursorY + "px";
          cursor.style.transform = `translate(-50%, -50%) scale(1) rotate(${angle}deg)`;
      }

      if (clickEffectRef.current) {
        clickEffectRef.current.style.left = cursorX + "px";
        clickEffectRef.current.style.top = cursorY + "px";
      }

      requestAnimationFrame(animate);
    };

    document.addEventListener("mousemove", mouseMove);
    document.addEventListener("mousedown", mouseDown);
    document.addEventListener("mouseup", mouseUp);
    animate();

    return () => {
      document.removeEventListener("mousemove", mouseMove);
      document.removeEventListener("mousedown", mouseDown);
      document.removeEventListener("mouseup", mouseUp);
    };
  }, []);

  return (
    <>
      <div
        ref={cursorRef}
        className={cn(
          "pointer-events-none fixed z-[9999] h-16 w-16 transition-opacity duration-300 ease-in-out"
        )}
      >
        <svg viewBox="-512 -512 1024 1024" className="w-full h-full" style={{ fill: 'hsl(var(--cursor-color))', stroke: 'hsl(var(--cursor-color))' }}>
           <path d="M0 0 C3.88818381 3.59657002 5.96092649 7.00314635 6.2109375 12.33984375 C5.93218504 22.18160414 1.05949443 31.03770413 -2.875 39.875 C-3.74586743 41.87526851 -4.61431539 43.87659195 -5.48046875 45.87890625 C-7.26748863 50.00641174 -9.06373771 54.12970965 -10.86621094 58.25048828 C-14.47237996 66.52009025 -17.94003566 74.84655898 -21.40338135 83.17672729 C-23.25220287 87.62045375 -25.11036491 92.06026635 -26.96875 96.5 C-27.33920441 97.38525864 -27.70965881 98.27051727 -28.09133911 99.18260193 C-32.37078787 109.40246027 -36.68557492 119.60737118 -41 129.8125 C-47.21314519 144.5101572 -53.40442004 159.2166814 -59.5625 173.9375 C-59.93230988 174.82149475 -60.30211975 175.7054895 -60.68313599 176.61627197 C-63.28977895 182.84792099 -65.8950534 189.08014172 -68.5 195.3125 C-71.47821212 202.43789941 -74.45705494 209.56303426 -77.4375 216.6875 C-77.80722931 217.57133362 -78.17695862 218.45516724 -78.55789185 219.36578369 C-84.73935656 234.13895812 -90.96151619 248.89471829 -97.19747925 263.6449585 C-102.99344949 277.35564925 -108.75948141 291.07850414 -114.5 304.8125 C-120.63583851 319.49228535 -126.80443778 334.15782196 -133 348.8125 C-139.21314519 363.5101572 -145.40442004 378.2166814 -151.5625 392.9375 C-151.93230988 393.82149475 -152.30211975 394.7054895 -152.68313599 395.61627197 C-155.28977895 401.84792099 -157.8950534 408.08014172 -160.5 414.3125 C-161.98686552 417.86983919 -163.4738336 421.42713546 -164.9609375 424.984375 C-165.51497253 426.30975533 -165.51497253 426.30975533 -166.0802002 427.66191101 C-167.93485308 432.09763934 -169.79132692 436.5325923 -171.65136719 440.96606445 C-172.39518324 442.73909465 -173.13899834 444.51212526 -173.8828125 446.28515625 C-174.43902283 447.61073296 -174.43902283 447.61073296 -175.00646973 448.96308899 C-177.47412344 454.84948505 -179.92427455 460.74293585 -182.36613464 466.64007568 C-184.09019013 470.79879752 -185.82281566 474.95391732 -187.55691528 479.10845947 C-188.38613412 481.10065656 -189.21162881 483.09440834 -190.03317261 485.08978271 C-191.17515803 487.86219045 -192.33022027 490.62880746 -193.48828125 493.39453125 C-193.82088959 494.21126816 -194.15349792 495.02800507 -194.4961853 495.86949158 C-196.8174014 501.36184808 -199.42279788 506.20832622 -204.4765625 509.6640625 C-209.96303898 511.42227697 -215.74700593 511.10931549 -220.9375 508.75 C-226.07131673 503.86661335 -228.11005079 498.20240225 -229.63696289 491.42260742 C-229.81906437 490.65628085 -230.00116585 489.88995428 -230.18878555 489.10040569 C-230.79396234 486.54194879 -231.38322116 483.98009423 -231.97265625 481.41796875 C-232.40795977 479.56366071 -232.84428314 477.70959183 -233.28153992 475.85574341 C-234.22456121 471.84837846 -235.16063508 467.83947622 -236.09143066 463.82925415 C-237.57491449 457.43897473 -239.07477113 451.05260796 -240.57714844 444.66674805 C-242.7377412 435.47677698 -244.8919277 426.28532735 -247.04150391 417.09277344 C-252.18353272 395.10666901 -257.34790564 373.12584342 -262.53368092 351.15001774 C-264.33952478 343.49543147 -266.13764909 335.83908549 -267.92979908 328.18128204 C-269.05257916 323.39020375 -270.18155777 318.60060157 -271.31217384 313.81136703 C-271.83834063 311.57682088 -272.36192287 309.34166437 -272.88275719 307.10586929 C-273.59689719 304.04196767 -274.32025454 300.98038365 -275.04589844 297.91918945 C-275.25149919 297.02695773 -275.45709993 296.13472601 -275.66893101 295.21545696 C-277.27649854 288.432778 -277.27649854 288.432778 -280.5 282.3125 C-285.80522921 279.33263665 -291.61473599 278.16779169 -297.51489258 276.82666016 C-298.50449321 276.59619995 -299.49409384 276.36573975 -300.51368237 276.1282959 C-303.80590174 275.3632122 -307.10017962 274.60740755 -310.39453125 273.8515625 C-312.74183389 273.30798478 -315.08899889 272.76381238 -317.43603516 272.21908569 C-323.09851922 270.9062712 -328.76231956 269.59925787 -334.42668021 268.29456651 C-340.97319799 266.78619755 -347.5177452 265.26936488 -354.06209409 263.75161791 C-365.37243817 261.12863282 -376.6837924 258.5100383 -387.99609375 255.89550781 C-388.65021535 255.74432259 -389.30433696 255.59313737 -389.97828043 255.43737078 C-394.48549876 254.39565406 -398.99274904 253.35407555 -403.5 252.3125 C-417.83420973 248.99987255 -432.16804531 245.68569699 -446.49856091 242.35711861 C-452.32138664 241.00498137 -458.14559954 239.65905166 -463.97100258 238.31806374 C-467.55146365 237.49250343 -471.13066516 236.6615853 -474.70953369 235.82915115 C-476.34693195 235.44945065 -477.98484642 235.07196784 -479.62332153 234.69694138 C-481.84513377 234.18808908 -484.06493269 233.67121199 -486.28442383 233.15234375 C-487.51784012 232.86738037 -488.75125641 232.58241699 -490.02204895 232.28881836 C-496.39491561 230.49984933 -501.04294499 228.42500428 -505.5 223.3125 C-507.59790168 219.11669663 -506.90124136 213.88186058 -506.5 209.3125 C-503.66312924 202.22032311 -496.6548944 200.15795238 -490.06210327 197.22967529 C-487.58419197 196.1727361 -485.09739078 195.14064474 -482.60546875 194.1171875 C-481.67670425 193.73206497 -480.74793976 193.34694244 -479.79103088 192.95014954 C-477.79642007 192.12338854 -475.80115718 191.29819923 -473.80529785 190.47445679 C-468.42823254 188.25492524 -463.05618256 186.02330913 -457.68359375 183.79296875 C-456.58338898 183.33656509 -455.4831842 182.88016144 -454.34963989 182.40992737 C-443.29621394 177.82095424 -432.27123514 173.16563347 -421.25 168.5 C-406.52337928 162.26925608 -391.78143976 156.07768642 -377.0168457 149.9375 C-375.55158989 149.32813741 -374.08633927 148.71876234 -372.62109375 148.109375 C-371.88967667 147.80519653 -371.15825958 147.50101807 -370.40467834 147.18762207 C-361.0761383 143.30645319 -351.75696463 139.40289781 -342.4375 135.5 C-341.5380365 135.12334198 -340.638573 134.74668396 -339.71185303 134.35861206 C-335.13709304 132.44286297 -330.56241838 130.52691026 -325.98779297 128.61083984 C-317.88604886 125.21756813 -309.78349556 121.8262297 -301.68099976 118.43475342 C-298.99472477 117.31029182 -296.30851064 116.18568497 -293.62231445 115.06103516 C-285.5785653 111.69339415 -277.53453151 108.32644231 -269.48893738 104.96321106 C-250.16525372 96.88540724 -230.85332073 88.78100629 -211.5625 80.625 C-196.00256256 74.04648893 -180.42468655 67.51340843 -164.82635498 61.02651978 C-164.09861877 60.723862 -163.37088257 60.42120422 -162.62109375 60.109375 C-161.88965149 59.80518646 -161.15820923 59.50099792 -160.40460205 59.18759155 C-151.07608909 55.30642886 -141.75693937 51.40288723 -132.4375 47.5 C-131.5380365 47.12334198 -130.638573 46.74668396 -129.71185303 46.35861206 C-125.13709304 44.44286297 -120.56241838 42.52691026 -115.98779297 40.61083984 C-110.56635436 38.34016652 -105.14456382 36.07033453 -99.72265625 33.80078125 C-98.83601288 33.42963699 -97.94936951 33.05849274 -97.03585815 32.67610168 C-92.59036359 30.81527514 -88.14481658 28.95457396 -83.69921875 27.09399414 C-75.32925374 23.59082788 -66.95975083 20.08656935 -58.59176636 16.57867432 C-54.65477264 14.92834444 -50.71753241 13.27860317 -46.78027344 11.62890625 C-44.90987033 10.84502037 -43.03958702 10.06084855 -41.16943359 9.27636719 C-36.27467202 7.22318047 -31.37758474 5.17581984 -26.47637939 3.13806152 C-24.73990658 2.41271236 -23.00799648 1.67646032 -21.27685547 0.93847656 C-13.96693564 -2.12325576 -7.42998237 -3.58231293 0 0 Z" fill="#0082FF" transform="translate(497.875,-0.4375)"/>
        </svg>
      </div>
      <div
        ref={clickEffectRef}
        className={cn(
          "pointer-events-none fixed z-[9998] hidden"
        )}
      >
        <div 
            className="h-32 w-32 rounded-full border-2" 
            style={{ borderColor: 'hsl(var(--cursor-color))', animation: 'click-pulse 0.5s ease-out forwards' }}
        />
      </div>
    </>
  );
}
```